# ğŸŸ æ‘¸é±¼å­¦ä¹ ç«™ (Moyu-Study)

> ä¸“ä¸šçš„ Linux & Docker æŠ€æœ¯å­¦ä¹ å¹³å°ï¼Œç®€æ´é«˜æ•ˆçš„å­¦ä¹ ä½“éªŒ

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

æ‘¸é±¼å­¦ä¹ ç«™æ˜¯ä¸€ä¸ªä¸“ä¸ºæŠ€æœ¯å­¦ä¹ è€…è®¾è®¡çš„åœ¨çº¿æ•™è‚²å¹³å°ï¼Œä¸“æ³¨äº Linux å‘½ä»¤å’Œ Docker å®¹å™¨æŠ€æœ¯çš„ç³»ç»Ÿå­¦ä¹ ã€‚å¹³å°æä¾›å®Œæ•´çš„å­¦ä¹ è·¯å¾„ã€ç»ƒä¹ é¢˜ç›®å’Œè¿›åº¦è·Ÿè¸ªåŠŸèƒ½ã€‚

**ğŸŒŸ ç‰¹è‰²åŠŸèƒ½**
- ğŸ“š **Linux å‘½ä»¤å­¦ä¹ ** - 150+ å¸¸ç”¨å‘½ä»¤ï¼Œä»åŸºç¡€åˆ°è¿›é˜¶
- ğŸ³ **Docker æŠ€æœ¯å®æˆ˜** - 80+ çŸ¥è¯†ç‚¹ï¼Œæ¶µç›–ç†è®ºåˆ°å®è·µ
- âœï¸ **æ™ºèƒ½ç»ƒä¹ ç³»ç»Ÿ** - 500+ ç»ƒä¹ é¢˜ï¼Œæ”¯æŒå¤šç§ç»ƒä¹ æ¨¡å¼
- ğŸ“Š **å­¦ä¹ è¿›åº¦è¿½è¸ª** - å¯è§†åŒ–å­¦ä¹ ç»Ÿè®¡å’Œæˆå°±ç³»ç»Ÿ
- ğŸ“± **å“åº”å¼è®¾è®¡** - å®Œç¾é€‚é…æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ”— æ¼”ç¤ºåœ°å€
- **ä¸»ç«™**: http://114.132.189.90
- **Linux å­¦ä¹ **: http://114.132.189.90/linux
- **Docker å­¦ä¹ **: http://114.132.189.90/docker
- **ç»ƒä¹ ç³»ç»Ÿ**: http://114.132.189.90/practice

### ğŸ› ï¸ æŠ€æœ¯æ ˆ

**å‰ç«¯**
- Vue 3.4+ - ç°ä»£åŒ–å‰ç«¯æ¡†æ¶
- TypeScript 5.0+ - ç±»å‹å®‰å…¨å¼€å‘
- Element Plus - UI ç»„ä»¶åº“
- Vite 5.0+ - æé€Ÿæ„å»ºå·¥å…·

**åç«¯**
- Node.js 20+ - æœåŠ¡å™¨è¿è¡Œæ—¶
- Fastify 4.0+ - é«˜æ€§èƒ½ Web æ¡†æ¶
- MySQL 5.7 - å…³ç³»å‹æ•°æ®åº“
- TypeScript 5.0+ - ç±»å‹å®‰å…¨å¼€å‘

**éƒ¨ç½²**
- Docker 23.0+ - å®¹å™¨åŒ–å¹³å°
- Docker Compose 2.5+ - å®¹å™¨ç¼–æ’
- CentOS 7+ - ç”Ÿäº§ç¯å¢ƒæ“ä½œç³»ç»Ÿ

## ğŸ“¦ æ ‡å‡†åŒ–éƒ¨ç½²æŒ‡å—

### âš™ï¸ ç¯å¢ƒè¦æ±‚

**ç¡¬ä»¶è¦æ±‚**
- CPU: 2æ ¸å¿ƒä»¥ä¸Š (æ¨è4æ ¸å¿ƒ)
- å†…å­˜: 4GBä»¥ä¸Š (æ¨è8GB)
- å­˜å‚¨: 20GBå¯ç”¨ç©ºé—´ (æ¨è50GB SSD)
- ç½‘ç»œ: å…¬ç½‘IPï¼Œå¯è®¿é—® GitHub å’Œ Docker Hub

**è½¯ä»¶è¦æ±‚**
- æ“ä½œç³»ç»Ÿ: CentOS 7.x / Ubuntu 18.04+
- Docker: 23.x æˆ–æ›´é«˜ç‰ˆæœ¬
- Docker Compose: 2.5.x æˆ–æ›´é«˜ç‰ˆæœ¬
- Git: 1.8+ 

**ç«¯å£é…ç½®**
| ç«¯å£ | åè®® | ç”¨é€” | è¯´æ˜ |
|------|------|------|------|
| 80   | TCP  | HTTP | Web æœåŠ¡è®¿é—® |
| 33067| TCP  | MySQL | æ•°æ®åº“è®¿é—®(ä»…é™æœ¬æœº) |
| 9000 | TCP  | Webhook | è‡ªåŠ¨éƒ¨ç½²è§¦å‘ |

### ğŸ”§ Linux æ ‡å‡†éƒ¨ç½²è„šæœ¬

#### 1. ç¯å¢ƒæ£€æŸ¥å’Œä¾èµ–å®‰è£…

```bash
#!/bin/bash
# install-dependencies.sh

echo "ğŸ”§ æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒå’Œå®‰è£…ä¾èµ–..."

# æ£€æŸ¥æ“ä½œç³»ç»Ÿ
if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    echo "âœ… Linux ç³»ç»Ÿæ£€æµ‹é€šè¿‡"
else
    echo "âŒ éœ€è¦Linuxç³»ç»Ÿç¯å¢ƒ"
    exit 1
fi

# å®‰è£… Git
if ! command -v git &> /dev/null; then
    echo "ğŸ“¦ å®‰è£… Git..."
    if command -v yum &> /dev/null; then
        sudo yum install -y git
    elif command -v apt-get &> /dev/null; then
        sudo apt-get update && sudo apt-get install -y git
    else
        echo "âŒ æ— æ³•å®‰è£…Gitï¼Œè¯·æ‰‹åŠ¨å®‰è£…"
        exit 1
    fi
fi

# å®‰è£… Docker
if ! command -v docker &> /dev/null; then
    echo "ğŸ“¦ å®‰è£… Docker..."
    curl -fsSL https://get.docker.com | sh
    sudo systemctl start docker
    sudo systemctl enable docker
    sudo usermod -aG docker $USER
fi

# å®‰è£… Docker Compose
if ! command -v docker-compose &> /dev/null; then
    echo "ğŸ“¦ å®‰è£… Docker Compose..."
    sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
    sudo chmod +x /usr/local/bin/docker-compose
fi

# é…ç½®é˜²ç«å¢™
echo "ğŸ”¥ é…ç½®é˜²ç«å¢™è§„åˆ™..."
if command -v firewall-cmd &> /dev/null; then
    sudo firewall-cmd --permanent --add-port=80/tcp
    sudo firewall-cmd --permanent --add-port=9000/tcp
    sudo firewall-cmd --reload
elif command -v ufw &> /dev/null; then
    sudo ufw allow 80/tcp
    sudo ufw allow 9000/tcp
    sudo ufw --force enable
fi

echo "âœ… ç¯å¢ƒæ£€æŸ¥å’Œä¾èµ–å®‰è£…å®Œæˆ"
```

#### 2. é¡¹ç›®æ‹‰å–å’Œåˆå§‹åŒ–

```bash
#!/bin/bash
# deploy-moyu.sh

echo "ğŸš€ å¼€å§‹éƒ¨ç½²æ‘¸é±¼å­¦ä¹ ç«™..."

# è®¾ç½®å˜é‡
PROJECT_DIR="/opt/moyu"
REPO_URL="https://github.com/YYY2579/moyu.git"

# åˆ›å»ºéƒ¨ç½²ç›®å½•
sudo mkdir -p $PROJECT_DIR
sudo chown $USER:$USER $PROJECT_DIR

# å…‹éš†é¡¹ç›®
if [ -d "$PROJECT_DIR/.git" ]; then
    echo "ğŸ“¥ æ›´æ–°ç°æœ‰é¡¹ç›®..."
    cd $PROJECT_DIR
    git pull origin main
else
    echo "ğŸ“¥ å…‹éš†é¡¹ç›®..."
    git clone $REPO_URL $PROJECT_DIR
    cd $PROJECT_DIR
fi

# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
echo "ğŸ“ ç”Ÿæˆç¯å¢ƒé…ç½®..."
cat > .env << EOF
# æ•°æ®åº“é…ç½®
MYSQL_ROOT_PASSWORD=moyu123456
MYSQL_DATABASE=moyu_study
MYSQL_USER=moyu_user
MYSQL_PASSWORD=moyu_user_password

# JWTé…ç½®
JWT_SECRET=moyu_jwt_secret_key_2024

# Webhooké…ç½®
WEBHOOK_SECRET=moyu_webhook_secret_2024

# æ—¶åŒºé…ç½®
TZ=Asia/Shanghai
EOF

# è®¾ç½®æ–‡ä»¶æƒé™
chmod 600 .env
chmod +x scripts/*.sh

echo "âœ… é¡¹ç›®åˆå§‹åŒ–å®Œæˆ"
```

#### 3. æœåŠ¡å¯åŠ¨å’Œå¥åº·æ£€æŸ¥

```bash
#!/bin/bash
# start-services.sh

echo "ğŸ”¨ æ„å»ºå’Œå¯åŠ¨æœåŠ¡..."

# åœæ­¢ç°æœ‰å®¹å™¨
docker-compose down --remove-orphans 2>/dev/null || true

# æ„å»ºé•œåƒ
echo "ğŸ—ï¸ æ„å»ºDockeré•œåƒ..."
docker-compose build --no-cache

# å¯åŠ¨æœåŠ¡
echo "ğŸš€ å¯åŠ¨æœåŠ¡..."
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 30

# å¥åº·æ£€æŸ¥
echo "ğŸ” æ‰§è¡Œå¥åº·æ£€æŸ¥..."
./scripts/health-check.sh

echo "âœ… æœåŠ¡å¯åŠ¨å®Œæˆ"
echo "ğŸŒ è®¿é—®åœ°å€: http://$(curl -s ifconfig.me)"
```

#### 4. ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# quick-deploy.sh - ä¸€é”®éƒ¨ç½²æ‘¸é±¼å­¦ä¹ ç«™

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "ğŸ¯ æ‘¸é±¼å­¦ä¹ ç«™ - ä¸€é”®éƒ¨ç½²è„šæœ¬"
echo "================================"

# æ£€æŸ¥æ˜¯å¦ä¸ºrootç”¨æˆ·
if [ "$EUID" -eq 0 ]; then
    echo "âŒ è¯·ä¸è¦ä½¿ç”¨rootç”¨æˆ·è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

# æ‰§è¡Œéƒ¨ç½²æ­¥éª¤
echo "ğŸ“ æ­¥éª¤ 1/4: ç¯å¢ƒæ£€æŸ¥å’Œä¾èµ–å®‰è£…"
./scripts/install-dependencies.sh

echo "ğŸ“ æ­¥éª¤ 2/4: é¡¹ç›®æ‹‰å–å’Œåˆå§‹åŒ–"
./scripts/deploy-moyu.sh

echo "ğŸ“ æ­¥éª¤ 3/4: æœåŠ¡å¯åŠ¨å’Œå¥åº·æ£€æŸ¥"
./scripts/start-services.sh

echo "ğŸ“ æ­¥éª¤ 4/4: éƒ¨ç½²éªŒè¯"
./scripts/verify-deployment.sh

echo ""
echo "ğŸ‰ éƒ¨ç½²å®Œæˆï¼"
echo "================================"
echo "ğŸŒ è®¿é—®åœ°å€: http://$(curl -s ifconfig.me)"
echo "ğŸ“± ç§»åŠ¨ç«¯: http://$(curl -s ifconfig.me)"
echo "ğŸ” å¥åº·æ£€æŸ¥: http://$(curl -s ifconfig.me)/health"
echo ""
echo "ğŸ“‹ ç®¡ç†å‘½ä»¤:"
echo "  æŸ¥çœ‹çŠ¶æ€: docker-compose ps"
echo "  æŸ¥çœ‹æ—¥å¿—: docker-compose logs -f"
echo "  é‡å¯æœåŠ¡: docker-compose restart"
echo "  åœæ­¢æœåŠ¡: docker-compose down"
echo ""
```

### ğŸ“‹ éƒ¨ç½²æ‰§è¡Œæ­¥éª¤

#### æ–¹æ³•ä¸€ï¼šä¸€é”®è‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# ä¸‹è½½å¹¶æ‰§è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬
curl -fsSL https://raw.githubusercontent.com/YYY2579/moyu/main/scripts/quick-deploy.sh | bash

# æˆ–è€…åˆ†æ­¥æ‰§è¡Œ
git clone https://github.com/YYY2579/moyu.git
cd moyu
chmod +x scripts/*.sh
sudo ./scripts/quick-deploy.sh
```

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ†æ­¥éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/YYY2579/moyu.git
cd moyu

# 2. å®‰è£…ä¾èµ–
sudo ./scripts/install-dependencies.sh

# 3. åˆå§‹åŒ–é¡¹ç›®
./scripts/deploy-moyu.sh

# 4. å¯åŠ¨æœåŠ¡
./scripts/start-services.sh

# 5. éªŒè¯éƒ¨ç½²
./scripts/verify-deployment.sh
```

#### æ–¹æ³•ä¸‰ï¼šç›´æ¥ Docker éƒ¨ç½²

```bash
# 1. æ‹‰å–é¡¹ç›®
git clone https://github.com/YYY2579/moyu.git
cd moyu

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®æ•°æ®åº“å¯†ç ç­‰

# 3. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 4. åˆå§‹åŒ–æ•°æ®åº“
docker-compose exec api npm run seed

# 5. å¥åº·æ£€æŸ¥
curl http://localhost/health
```

## ğŸ”§ ç®¡ç†å’Œç»´æŠ¤

### ğŸ“Š æœåŠ¡çŠ¶æ€ç®¡ç†

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f              # æ‰€æœ‰æœåŠ¡
docker-compose logs web              # WebæœåŠ¡
docker-compose logs api              # APIæœåŠ¡
docker-compose logs mysql            # MySQLæœåŠ¡

# æœåŠ¡æ§åˆ¶
docker-compose start                 # å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose stop                  # åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose restart               # é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose down                  # åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose down -v               # åœæ­¢å¹¶åˆ é™¤æ•°æ®å·
```

### ğŸ—„ï¸ æ•°æ®åº“ç®¡ç†

```bash
# è¿æ¥æ•°æ®åº“
docker-compose exec mysql mysql -u root -p

# æ•°æ®åº“å¤‡ä»½
docker-compose exec mysql mysqldump -u root -p moyu_study > backup_$(date +%Y%m%d).sql

# æ•°æ®åº“æ¢å¤
docker-compose exec -i mysql mysql -u root -p moyu_study < backup_20241228.sql

# æ•°æ®åº“ä¼˜åŒ–
docker-compose exec mysql mysql -u root -p -e "OPTIMIZE TABLE moyu_study.questions;"
```

### ğŸ”„ æ›´æ–°å’Œå‡çº§

```bash
# æ›´æ–°ä»£ç 
git pull origin main

# é‡æ–°æ„å»ºå’Œéƒ¨ç½²
docker-compose build --no-cache
docker-compose up -d

# éªŒè¯æ›´æ–°
curl http://localhost/health
```

### ğŸ§¹ æ¸…ç†å’Œç»´æŠ¤

```bash
# æ¸…ç†Dockerç¼“å­˜
docker system prune -f

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨
docker system prune -a

# æ—¥å¿—è½®è½¬
docker-compose logs --tail=1000 > /var/log/moyu-$(date +%Y%m%d).log
```

## ğŸ› é—®é¢˜æ’æŸ¥

### ğŸ” å¸¸è§é—®é¢˜è§£å†³

**1. ç«¯å£å ç”¨é—®é¢˜**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :80
sudo netstat -tlnp | grep :33067

# åœæ­¢å ç”¨æœåŠ¡
sudo systemctl stop nginx  # å¦‚æœnginxå ç”¨äº†80ç«¯å£
```

**2. æƒé™é—®é¢˜**
```bash
# ä¿®å¤æ–‡ä»¶æƒé™
sudo chown -R $USER:$USER /opt/moyu
chmod +x /opt/moyu/scripts/*.sh
```

**3. DockeræœåŠ¡é—®é¢˜**
```bash
# æ£€æŸ¥DockerçŠ¶æ€
sudo systemctl status docker

# é‡å¯DockeræœåŠ¡
sudo systemctl restart docker
```

**4. æ•°æ®åº“è¿æ¥é—®é¢˜**
```bash
# æ£€æŸ¥MySQLå®¹å™¨çŠ¶æ€
docker-compose ps mysql

# æŸ¥çœ‹MySQLæ—¥å¿—
docker-compose logs mysql

# é‡ç½®æ•°æ®åº“
docker-compose down -v
docker-compose up -d mysql
```

### ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. **æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—**: `journalctl -xe`
2. **æ£€æŸ¥Dockeræ—¥å¿—**: `docker-compose logs`
3. **ç½‘ç»œè¿é€šæ€§**: `curl -I http://github.com`
4. **ç£ç›˜ç©ºé—´**: `df -h`
5. **å†…å­˜ä½¿ç”¨**: `free -h`

## ğŸ“ é¡¹ç›®ç»“æ„

```
moyu-study-2/
â”œâ”€â”€ api/                    # åç«¯APIæœåŠ¡
â”‚   â”œâ”€â”€ src/               # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ routes/        # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ models/        # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ Dockerfile         # Dockeræ„å»ºæ–‡ä»¶
â”‚   â””â”€â”€ package.json       # ä¾èµ–é…ç½®
â”œâ”€â”€ web/                   # å‰ç«¯Webåº”ç”¨
â”‚   â”œâ”€â”€ src/              # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ views/         # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/    # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ router/        # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ utils/         # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ Dockerfile         # Dockeræ„å»ºæ–‡ä»¶
â”‚   â””â”€â”€ package.json       # ä¾èµ–é…ç½®
â”œâ”€â”€ scripts/               # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ install-dependencies.sh
â”‚   â”œâ”€â”€ deploy-moyu.sh
â”‚   â”œâ”€â”€ start-services.sh
â”‚   â””â”€â”€ health-check.sh
â”œâ”€â”€ deploy/               # éƒ¨ç½²ç›¸å…³
â”‚   â”œâ”€â”€ mysql-init/       # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ volumes/          # æ•°æ®æŒä¹…åŒ–
â”œâ”€â”€ docker-compose.yml    # å®¹å™¨ç¼–æ’é…ç½®
â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ README.md             # é¡¹ç›®æ–‡æ¡£
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: `git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹: `git commit -m 'Add amazing feature'`
4. æ¨é€åˆ†æ”¯: `git push origin feature/amazing-feature`
5. æäº¤ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ‰ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…å’Œå­¦ä¹ è€…ï¼

---

**ğŸš€ ç«‹å³å¼€å§‹æ‚¨çš„Linuxå’ŒDockerå­¦ä¹ ä¹‹æ—…ï¼**

*æœ€åæ›´æ–°: 2024å¹´12æœˆ28æ—¥*