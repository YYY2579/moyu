# ğŸ“ é¡¹ç›®ç»“æ„è¯¦è§£

## ğŸŒ² ç›®å½•æ ‘ç»“æ„

```
moyu/
â”œâ”€â”€ ğŸ“ api/                           # åç«¯APIæœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“ src/                      # æºä»£ç ç›®å½•
â”‚   â”‚   â”œâ”€â”€ ğŸ“ routes/                # APIè·¯ç”±å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ questions.ts           # é¢˜ç›®ç›¸å…³æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ daily.ts              # æ¯æ—¥åé¢˜æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ attempts.ts           # å­¦ä¹ è®°å½•æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ commands.ts           # å‘½ä»¤ç›¸å…³æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ devices.ts            # è®¾å¤‡ç®¡ç†æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ admin.ts              # ç®¡ç†å‘˜æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ health.ts            # å¥åº·æ£€æŸ¥æ¥å£
â”‚   â”‚   â”œâ”€â”€ ğŸ“ seed/                 # æ•°æ®åº“ç§å­æ•°æ®
â”‚   â”‚   â”‚   â”œâ”€â”€ seed.ts              # ç§å­æ•°æ®ç”Ÿæˆå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ hash.ts              # å“ˆå¸Œç®—æ³•å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ seed.sql             # SQLç§å­æ•°æ®
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ db.ts                # æ•°æ®åº“è¿æ¥é…ç½®
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ env.ts               # ç¯å¢ƒå˜é‡å¤„ç†
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts             # APIæœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ ğŸ“„ Dockerfile               # APIå®¹å™¨æ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ package.json             # Node.jsä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ package-lock.json        # ä¾èµ–é”å®šæ–‡ä»¶
â”‚   â””â”€â”€ ğŸ“„ tsconfig.json           # TypeScripté…ç½®
â”œâ”€â”€ ğŸ“ web/                           # å‰ç«¯Webåº”ç”¨
â”‚   â”œâ”€â”€ ğŸ“ src/                    # æºä»£ç ç›®å½•
â”‚   â”‚   â”œâ”€â”€ ğŸ“ pages/               # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ PracticePage.vue     # é¢˜åº“ç»ƒä¹ é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ DailyPage.vue        # æ¯æ—¥åé¢˜é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ QuestionPage.vue     # é¢˜ç›®è¯¦æƒ…é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ StatsPage.vue       # ç»Ÿè®¡é¡µé¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“ lib/                 # å·¥å…·å‡½æ•°åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts              # APIæ¥å£å°è£…
â”‚   â”‚   â”‚   â””â”€â”€ device.ts           # è®¾å¤‡IDç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/          # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ main.ts              # åº”ç”¨å…¥å£æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ ğŸ“„ App.vue              # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ ğŸ“ public/                 # é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.html          # HTMLæ¨¡æ¿
â”‚   â”œâ”€â”€ ğŸ“„ Dockerfile             # Webå®¹å™¨æ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ package.json           # Node.jsä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ package-lock.json      # ä¾èµ–é”å®šæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ tsconfig.json          # TypeScripté…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ vite.config.ts         # Viteæ„å»ºé…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ tailwind.config.js     # TailwindCSSé…ç½®
â”‚   â””â”€â”€ ğŸ“„ postcss.config.js      # PostCSSé…ç½®
â”œâ”€â”€ ğŸ“ deploy/                         # éƒ¨ç½²ç›¸å…³æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ mysql-init/            # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”‚   â””â”€â”€ ğŸ“„ 001_schema.sql      # æ•°æ®åº“ç»“æ„å®šä¹‰
â”‚   â””â”€â”€ ğŸ“ volumes/              # æ•°æ®æŒä¹…åŒ–ç›®å½•
â”‚       â””â”€â”€ ğŸ“ mysql/             # MySQLæ•°æ®ç›®å½•
â”œâ”€â”€ ğŸ“ scripts/                        # è¾…åŠ©è„šæœ¬
â”‚   â”œâ”€â”€ ğŸ“„ quick-health-check.sh    # å¿«é€Ÿå¥åº·æ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ ğŸ“„ fix-permissions.sh      # æƒé™ä¿®å¤è„šæœ¬
â”‚   â””â”€â”€ ğŸ“„ backup-database.sh      # æ•°æ®åº“å¤‡ä»½è„šæœ¬
â”œâ”€â”€ ğŸ“ .github/                       # GitHubé…ç½®
â”‚   â””â”€â”€ ğŸ“ workflows/            # GitHub Actions
â”‚       â””â”€â”€ ğŸ“„ ci.yml            # æŒç»­é›†æˆé…ç½®
â”œâ”€â”€ ğŸ“„ docker-compose.yml             # å®¹å™¨ç¼–æ’é…ç½®
â”œâ”€â”€ ğŸ“„ deploy-centos7.sh             # CentOS 7éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ ğŸ“„ .env                         # ç¯å¢ƒå˜é‡ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”œâ”€â”€ ğŸ“„ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ ğŸ“„ .gitignore                   # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ PROJECT-STRUCTURE.md          # é¡¹ç›®ç»“æ„è¯´æ˜
â””â”€â”€ ğŸ“„ hooks.json                   # Webhooké…ç½®ï¼ˆå¯é€‰ï¼‰
```

## ğŸ—ï¸ æ¶æ„å±‚æ¬¡

### 1. å‰ç«¯æ¶æ„ (Vue.js)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¡¨ç°å±‚ (Presentation)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vue Components (Page/Component)      â”‚
â”‚  â”œâ”€ PracticePage.vue                 â”‚
â”‚  â”œâ”€ DailyPage.vue                   â”‚
â”‚  â”œâ”€ QuestionPage.vue                â”‚
â”‚  â””â”€ Reusable Components            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              ä¸šåŠ¡å±‚ (Business)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Services (lib/api.ts)          â”‚
â”‚  â”œâ”€ getMeta()                      â”‚
â”‚  â”œâ”€ listQuestions()                â”‚
â”‚  â”œâ”€ getDaily()                     â”‚
â”‚  â”œâ”€ postAttempt()                  â”‚
â”‚  â””â”€ Device Management (lib/device.ts)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æ•°æ®å±‚ (Data)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTTP Requests (fetch)              â”‚
â”‚  â”œâ”€ API Endpoints                  â”‚
â”‚  â””â”€ Error Handling                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. åç«¯æ¶æ„ (Node.js)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è·¯ç”±å±‚ (Routing)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Fastify Routes                      â”‚
â”‚  â”œâ”€ /api/questions                 â”‚
â”‚  â”œâ”€ /api/daily                     â”‚
â”‚  â”œâ”€ /api/attempts                  â”‚
â”‚  â”œâ”€ /api/stats                     â”‚
â”‚  â”œâ”€ /api/admin                     â”‚
â”‚  â””â”€ /api/health                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æœåŠ¡å±‚ (Service)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Business Logic                      â”‚
â”‚  â”œâ”€ Question Management            â”‚
â”‚  â”œâ”€ Daily Algorithm               â”‚
â”‚  â”œâ”€ Attempt Tracking             â”‚
â”‚  â”œâ”€ Statistics Calculation        â”‚
â”‚  â””â”€ Admin Functions              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æ•°æ®å±‚ (Data)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MySQL Database                     â”‚
â”‚  â”œâ”€ Questions                     â”‚
â”‚  â”œâ”€ Attempts                     â”‚
â”‚  â”œâ”€ Devices                      â”‚
â”‚  â”œâ”€ Daily_Sets                   â”‚
â”‚  â””â”€ Tags                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ•°æ®åº“è®¾è®¡

```sql
-- æ ¸å¿ƒè¡¨ç»“æ„
questions          -- é¢˜ç›®è¡¨
â”œâ”€ id              -- é¢˜ç›®ID
â”œâ”€ title           -- é¢˜ç›®æ ‡é¢˜
â”œâ”€ category        -- é¢˜ç›®åˆ†ç±»
â”œâ”€ difficulty      -- éš¾åº¦ç­‰çº§ (1-4)
â”œâ”€ frequency       -- å‡ºç°é¢‘ç‡
â”œâ”€ content_md      -- é¢˜ç›®å†…å®¹
â”œâ”€ answer_md      -- ç­”æ¡ˆå†…å®¹
â””â”€ created_at     -- åˆ›å»ºæ—¶é—´

attempts          -- å­¦ä¹ è®°å½•è¡¨
â”œâ”€ id              -- è®°å½•ID
â”œâ”€ device_id       -- è®¾å¤‡ID
â”œâ”€ question_id     -- é¢˜ç›®ID
â”œâ”€ status          -- å­¦ä¹ çŠ¶æ€
â”œâ”€ seconds_spent  -- å­¦ä¹ æ—¶é•¿
â””â”€ created_at     -- è®°å½•æ—¶é—´

daily_sets        -- æ¯æ—¥é¢˜åº“è¡¨
â”œâ”€ id              -- é›†åˆID
â”œâ”€ device_id       -- è®¾å¤‡ID
â”œâ”€ day             -- æ—¥æœŸ
â””â”€ question_ids    -- é¢˜ç›®IDåˆ—è¡¨

devices           -- è®¾å¤‡è¡¨
â”œâ”€ id              -- è®¾å¤‡ID
â””â”€ created_at     -- æ³¨å†Œæ—¶é—´

tags              -- æ ‡ç­¾è¡¨
â”œâ”€ id              -- æ ‡ç­¾ID
â””â”€ name            -- æ ‡ç­¾åç§°

question_tags     -- é¢˜ç›®æ ‡ç­¾å…³è”è¡¨
â”œâ”€ question_id     -- é¢˜ç›®ID
â””â”€ tag_id         -- æ ‡ç­¾ID
```

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### 1. ç¯å¢ƒé…ç½® (.env)

```bash
# æ•°æ®åº“é…ç½®
MYSQL_DATABASE=study_site      # æ•°æ®åº“åç§°
MYSQL_USER=yyy               # æ•°æ®åº“ç”¨æˆ·
MYSQL_PASSWORD=Aa123456       # æ•°æ®åº“å¯†ç 
MYSQL_ROOT_PASSWORD=Aa123456  # Rootå¯†ç 

# åº”ç”¨é…ç½®
ADMIN_TOKEN=moyu_admin_token_2024  # ç®¡ç†å‘˜Token
TZ=Asia/Shanghai                    # æ—¶åŒºè®¾ç½®
SERVER_IP=114.132.189.90           # æœåŠ¡å™¨IP
```

### 2. Dockeré…ç½®

```yaml
# docker-compose.yml
services:
  mysql:    # æ•°æ®åº“æœåŠ¡
    image: mysql:5.7.44
    ports: ["127.0.0.1:33066:3306"]
    volumes: ["./deploy/volumes/mysql:/var/lib/mysql"]
    
  api:      # åç«¯APIæœåŠ¡
    build: ./api
    environment: [*æ•°æ®åº“é…ç½®*]
    depends_on: [mysql]
    
  web:      # å‰ç«¯WebæœåŠ¡
    build: ./web
    ports: ["80:80"]
    depends_on: [api]
```

### 3. TypeScripté…ç½®

```json
// tsconfig.json (API)
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "node",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "outDir": "./dist"
  }
}
```

## ğŸš€ éƒ¨ç½²æµç¨‹

### 1. å¼€å‘ç¯å¢ƒ

```bash
# 1. å®‰è£…ä¾èµ–
cd api && npm install
cd ../web && npm install

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev:api    # åç«¯å¼€å‘æœåŠ¡å™¨
npm run dev:web     # å‰ç«¯å¼€å‘æœåŠ¡å™¨
```

### 2. ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. ä¸€é”®éƒ¨ç½²
sudo ./deploy-centos7.sh

# 2. éªŒè¯éƒ¨ç½²
./scripts/quick-health-check.sh
```

### 3. å®¹å™¨ç®¡ç†

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. æ—¥å¿—ä½ç½®

- **åº”ç”¨æ—¥å¿—**: `docker-compose logs [service]`
- **ç³»ç»Ÿæ—¥å¿—**: `/var/log/messages`
- **Dockeræ—¥å¿—**: `/var/log/docker.log`
- **éƒ¨ç½²æ—¥å¿—**: `deploy-centos7.sh` è¾“å‡º

### 2. å¥åº·æ£€æŸ¥

```bash
# å¿«é€Ÿå¥åº·æ£€æŸ¥
./scripts/quick-health-check.sh

# APIå¥åº·æ£€æŸ¥
curl http://localhost/api/health

# WebæœåŠ¡æ£€æŸ¥
curl -I http://localhost/
```

### 3. æ€§èƒ½ç›‘æ§

```bash
# Dockerèµ„æºä½¿ç”¨
docker stats

# ç³»ç»Ÿèµ„æº
top
htop
free -h
df -h
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. ç½‘ç»œå®‰å…¨

- MySQLä»…é™æœ¬æœºè®¿é—® (`127.0.0.1:33066`)
- ä½¿ç”¨é˜²ç«å¢™é™åˆ¶ç«¯å£è®¿é—®
- SELinuxå¼ºåˆ¶è®¿é—®æ§åˆ¶

### 2. è®¤è¯å®‰å…¨

- ç®¡ç†å‘˜æ¥å£Tokenè®¤è¯
- è®¾å¤‡IDéš”ç¦»å­¦ä¹ è®°å½•
- æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡å­˜å‚¨

### 3. æ•°æ®å®‰å…¨

- æ•°æ®åº“å¯†ç å¼ºåº¦è¦æ±‚
- å®šæœŸå¤‡ä»½æœºåˆ¶
- å®¹å™¨éš”ç¦»è¿è¡Œ

---

è¿™ä¸ªé¡¹ç›®ç»“æ„è®¾è®¡æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ï¼ŒåŒæ—¶è€ƒè™‘äº†å®‰å…¨æ€§ã€æ€§èƒ½å’Œå¯éƒ¨ç½²æ€§ã€‚